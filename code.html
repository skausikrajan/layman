<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Layout Manager - Store </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin:0; background: #f6f7fb; color: #1b253b; }
    .top-bar {
      background: #395bdf;
      color: #fff;
      display: flex; align-items: center;
      justify-content: space-between;
      padding: 1rem 2vw;
      box-shadow: 0 1px 6px rgba(30,50,100,0.07);
    }
    .main {
      max-width: 900px; margin: 38px auto; padding-bottom:60px;
      display: flex; gap:48px;
      align-items: flex-start;
    }
    .walls-panel {
      width: 190px; min-width: 180px;
      background: #fff; border-radius: 13px; padding:24px 12px 20px 12px;
      box-shadow: 0 1px 18px rgba(20,28,80,0.06);
      display: flex; flex-direction: column;
      gap: 10px;
      align-items: stretch;
      min-height: 370px;
    }
    .walls-panel h3 {
      font-size: 1.08rem; color: #2d325e;
      margin: 0 0 7px 5px; font-weight: 600;
    }
    .wall-folder {
      padding:10px 5px 10px 22px;
      border-radius: 6px 18px 18px 6px;
      cursor: pointer;
      color: #3554bb;
      font-weight: 600;
      letter-spacing: .01em;
      margin-bottom: 2px;
      background: #f7faff;
      border: 1.5px solid #e3eafa;
      box-shadow: 0 .5px 2px #dce3f7;
      transition: background .13s, color .16s;
      position:relative;
    }
    .wall-folder.selected, .wall-folder:hover {
      background: #d6e1ff;
      color: #142479;
      border-color: #bed7ff;
    }
    .wall-folder .count {
      background: #395bdf; color:#fff;
      padding:0 8px; font-size: 13px; margin-left:12px;
      border-radius: 7px;
    }
    .actions-panel {
      margin-bottom: 12px;
      display: flex; gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }
    .option-btn {
      background: #395bdf; color: #fff;
      font-weight: 500; border: none;
      border-radius: 7px; padding: 8px 22px; margin-right: 2px;
      cursor: pointer; font-size: 1rem;
      box-shadow: 0 2px 8px rgba(60,100,200,0.03);
      transition: background .16s;
    }
    .option-btn:disabled { opacity: 0.55; cursor: not-allowed; }
    .option-btn:hover:not(:disabled) { background: #264db1; }
    .wall-name-heading {
      font-size: 1.18rem;
      color: #395bdf;
      font-weight: 500;
      letter-spacing: .03em;
    }
    .fixtures-area {
      position: relative;
      width: 520px; height: 400px;
      background: #fff;
      border: 2.5px solid #dff2fa;
      border-radius: 20px;
      box-shadow: 0 3px 15px rgba(35,54,120,0.08);
      overflow: visible;
      min-width: 330px;
    }
    /** Fixture style **/
    .fixture {
      position: absolute;
      background: #fafdff; border: 2px solid #25b4cf;
      border-radius: 12px;
      min-width: 54px; min-height: 54px;
      box-shadow: 0 2px 7px rgba(30,40,80,0.10);
      cursor: grab;
      user-select: none;
      transition: border .14s, box-shadow .14s, width .18s, height .18s;
      z-index: 12;
      display: flex; flex-direction: column;
      align-items: flex-start; justify-content: flex-start;
    }
    .fixture-header {
      font-size: 12.5px; color: #2e69d8;
      font-weight: bold; margin: 7px 0 2px 0; text-align:center; width:100%;
    }
    .fixture-details {
      font-size: 12px; padding: 3.5px 9px 2px 9px;
      color: #22707c;
      word-break:break-word; text-align:left;
    }
    .fixture-edit-btn, .fixture-delete-btn {
      position: absolute; top: 6px;
      background: #e6edfd; color: #395bdf; border: none;
      border-radius: 5px; font-size: 14px; padding: 0 5px;
      cursor: pointer; z-index: 1001; display: none;
      transition: background .11s;
    }
    .fixture-edit-btn:hover, .fixture-delete-btn:hover { background: #e1e7fb; }
    .fixture-edit-btn { right: 29px; }
    .fixture-delete-btn { right: 8px; color: #c23b2f;}
    .fixture:hover .fixture-edit-btn,
    .fixture:hover .fixture-delete-btn,
    .edit-mode .fixture-edit-btn,
    .edit-mode .fixture-delete-btn { display: block; }
    .edit-mode .fixture { border-color: #395bdf; }
    .fixture.dragging {
      border: 2.6px dashed #2946b9;
      opacity: 0.85;
    }
    /** Modal **/
    .modal-bg {
      position: fixed; top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,64,0.13); z-index: 1000;
      display: flex; align-items: center; justify-content: center;
      animation: fadeIn .18s cubic-bezier(.6,.11,.55,1);
    }
    @keyframes fadeIn { from{ opacity: 0;} to{ opacity: 1;} }
    .modal {
      background: #fff; border-radius: 13px; box-shadow: 0 10px 54px rgba(24,34,84,0.13);
      width: 350px; max-width: 96vw; padding: 32px 27px;
      display: flex; flex-direction: column; gap: 12px;
    }
    .modal h3 { margin-top:0; margin-bottom:10px; font-size:18px; color: #2443b9; font-weight:600;}
    .modal label { font-weight: 500; font-size: 14.5px; margin-bottom: 5px; color: #395bdf;}
    .modal input, .modal select {
      border: 1.2px solid #d9dbe7; border-radius: 6px;
      font-size: 15px; padding: 7px 11px; margin-bottom: 8px;
      background: #f6f8fd; color:#1a243e;
    }
    .modal-buttons { display: flex; gap:14px; margin-top: 9px;}
    .main-btn { background: #395bdf; color:#fff; border: none; border-radius: 7px; padding: 8px 18px; cursor: pointer; font-size: 15px;}
    .cancel-btn { background: #edf0fd; color: #395bdf; border:none; border-radius: 7px; font-weight:600; padding: 8px 10px; font-size: 15px; cursor:pointer;}
    @media (max-width: 900px) { .main{flex-direction:column;gap:22px;align-items:center;} .walls-panel{min-height:0;} .fixtures-area{max-width:98vw;} }
  </style>
</head>
<body>
  <div class="top-bar">
    <div style="font-size: 1.20rem; font-weight:600">Store Walls & Floor Fixtures Manager</div>
  </div>
  <div class="main">
    <!-- Walls and Floor Fixtures List -->
    <div class="walls-panel">
      <h3>Walls & Floor</h3>
      <div id="wallsList"></div>
    </div>
    <div style="flex:1; min-width:300px;">
      <div class="actions-panel">
        <button class="option-btn" id="addFixtureBtn">Add Fixture</button>
        <button class="option-btn" id="toggleEditBtn">Edit Mode</button>
        <span class="wall-name-heading" id="selectedWallLabel"></span>
      </div>
      <div class="fixtures-area" id="fixturesArea"></div>
    </div>
  </div>
  <!-- Modal -->
  <div class="modal-bg" id="fixtureModalBg" style="display:none;">
    <form class="modal" id="fixtureForm">
      <h3 id="modalTitle">Add Fixture</h3>
      <label for="fixtureName">Fixture Name</label>
      <input type="text" id="fixtureName" required maxlength="18" autocomplete="off"/>
      <label for="fixtureType">Fixture Type</label>
      <input type="text" id="fixtureType" required maxlength="18" autocomplete="off"/>
      <label for="fixtureFt">Fixture ft</label>
      <input type="number" id="fixtureFt" required min="0.1" step="0.01" />

      <label for="fixtureWall">Assign to Wall/Folder</label>
      <select id="fixtureWall" required>
        <option value="">Select Wall/Folder</option>
      </select>

      <div class="modal-buttons">
        <button type="submit" class="main-btn" id="saveBtn">Add</button>
        <button type="button" class="cancel-btn" id="cancelModalBtn">Cancel</button>
      </div>
    </form>
  </div>
<script>
const wallNames = ["Wall 1", "Wall 2", "Wall 3", "Wall 4", "Wall 5", "Floor Fixtures"];
const wallKeys = ["wall1", "wall2", "wall3", "wall4", "wall5", "floor"];
let fixtureIdSeq = 1;
let fixturesByWall = {
  wall1:[], wall2:[], wall3:[], wall4:[], wall5:[], floor:[]
};
let selectedWall = "wall1";
let editingFixture = null;
let isEditMode = false;
const wallDefaults = [
  idx => ({ left: 20 + idx * 100, top: 30 }),    // wall1 top horizontal
  idx => ({ left: 380, top: 30 + idx * 80 }),    // wall2 right vertical
  idx => ({ left: 350, top: 190 + idx * 80 }),   // wall3 right lower vertical
  idx => ({ left: 20 + idx * 100, top: 280 }),   // wall4 bottom horizontal
  idx => ({ left: 40, top: 30 + idx * 80 }),     // wall5 left vertical
  idx => ({ left: 50 + (idx % 5) * 95, top: 30 + Math.floor(idx / 5) * 95 }) // floor: grid
];

function renderWalls() {
  const wallsList = document.getElementById("wallsList");
  wallsList.innerHTML = "";
  for (let i = 0; i < wallKeys.length; ++i) {
    let wall = wallKeys[i];
    let count = fixturesByWall[wall].length;
    let div = document.createElement("div");
    div.className = "wall-folder" + (selectedWall === wall ? " selected" : "");
    div.innerHTML = wallNames[i] + `<span class="count">${count}</span>`;
    div.onclick = () => {
      selectedWall = wall;
      renderWalls();
      renderFixtures();
    };
    wallsList.appendChild(div);
  }
  document.getElementById("selectedWallLabel").textContent =
    wallNames[wallKeys.indexOf(selectedWall)] + " View";
  populateWallSelectOptions();
}

function getFixtureSizeForWall(n) {
  const max = 100, min = 60;
  if (n <= 4) return 90;
  return Math.max(min, max - (n - 4) * 8);
}

function renderFixtures() {
  const fixturesArea = document.getElementById("fixturesArea");
  fixturesArea.innerHTML = "";
  const fixtures = fixturesByWall[selectedWall];
  const count = fixtures.length;
  const size = getFixtureSizeForWall(count);

  fixtures.forEach((fx, index) => {
    if (!fx.customPos) {
      let pos = wallDefaults[wallKeys.indexOf(selectedWall)](index);
      fx.customPos = { x: pos.left, y: pos.top };
    }
  });

  fixtures.forEach((fx, idx) => {
    const el = document.createElement("div");
    el.className = "fixture" + (isEditMode ? " edit-mode" : "");
    el.style.width = el.style.height = size + "px";
    el.style.left = fx.customPos.x + "px";
    el.style.top = fx.customPos.y + "px";

    // Edit and DELETE buttons (edit left, delete at far right)
    el.innerHTML = `
      <div class="fixture-header">Fixture ${idx + 1}</div>
      <div class="fixture-details">
        <div><b>${fx.name}</b></div>
        <div>${fx.type}</div>
        <div>${fx.ft} ft</div>
      </div>
      <button class="fixture-edit-btn" title="Edit">&#9998;</button>
      <button class="fixture-delete-btn" title="Delete">&#128465;</button>
    `;

    el.querySelector(".fixture-edit-btn").onclick = ev => {
      ev.stopPropagation();
      if(!isEditMode) return;
      openFixtureModal("edit", fx);
    };

    el.querySelector(".fixture-delete-btn").onclick = ev => {
      ev.stopPropagation();
      if (!isEditMode) return;
      deleteFixtureConfirm(fx);
    };

    makeDraggable(el, fx);
    fixturesArea.appendChild(el);
  });
}

function deleteFixtureConfirm(fx) {
  const result = window.confirm(`Delete fixture "${fx.name}"?\n(This action is permanent)`);
  if (result) {
    const arr = fixturesByWall[fx.wall];
    const idx = arr.indexOf(fx);
    if (idx > -1) arr.splice(idx, 1);
    renderWalls();
    renderFixtures();
  }
}

function populateWallSelectOptions() {
  const select = document.getElementById("fixtureWall");
  select.innerHTML = '<option value="">Select Wall/Folder</option>';
  for (let i=0; i<wallKeys.length; i++){
    const opt = document.createElement("option");
    opt.value = wallKeys[i];
    opt.textContent = wallNames[i];
    select.appendChild(opt);
  }
  if(editingFixture){
    select.value = editingFixture.wall;
  } else {
    select.value = selectedWall;
  }
}

function makeDraggable(elem, fixture) {
  elem.onmousedown = function(e) {
    if (e.button !== 0 || e.target.classList.contains("fixture-edit-btn") || e.target.classList.contains("fixture-delete-btn")) return;
    const areaRect = document.getElementById("fixturesArea").getBoundingClientRect();
    const elemRect = elem.getBoundingClientRect();
    const offsetX = e.clientX - elemRect.left;
    const offsetY = e.clientY - elemRect.top;
    elem.classList.add("dragging");

    document.onmousemove = function(ev) {
      let x = Math.min(Math.max(0, ev.clientX - areaRect.left - offsetX), areaRect.width - elem.offsetWidth);
      let y = Math.min(Math.max(0, ev.clientY - areaRect.top - offsetY), areaRect.height - elem.offsetHeight);
      elem.style.left = x + "px";
      elem.style.top = y + "px";
    };
    document.onmouseup = function() {
      fixture.customPos = {
        x: parseInt(elem.style.left),
        y: parseInt(elem.style.top)
      };
      elem.classList.remove("dragging");
      document.onmousemove = document.onmouseup = null;
    };
    return false;
  };
}

function openFixtureModal(mode, fixture = null) {
  const modalBg = document.getElementById('fixtureModalBg');
  modalBg.style.display = "flex";
  document.body.style.overflow = "hidden";
  const form = document.getElementById('fixtureForm');
  form.reset();
  editingFixture = null;

  populateWallSelectOptions();

  if (mode === "edit" && fixture) {
    editingFixture = fixture;
    document.getElementById('modalTitle').innerText = "Edit Fixture";
    document.getElementById('saveBtn').innerText = "Update";
    document.getElementById('fixtureName').value = fixture.name;
    document.getElementById('fixtureType').value = fixture.type;
    document.getElementById('fixtureFt').value = fixture.ft;
    document.getElementById('fixtureWall').value = fixture.wall;
  } else {
    document.getElementById('modalTitle').innerText = "Add Fixture";
    document.getElementById('saveBtn').innerText = "Add";
    document.getElementById('fixtureWall').value = selectedWall;
  }
  setTimeout(() => document.getElementById('fixtureName').focus(), 40);
}

function closeFixtureModal() {
  document.getElementById('fixtureModalBg').style.display = "none";
  document.body.style.overflow = "";
  editingFixture = null;
}

document.getElementById('cancelModalBtn').onclick = closeFixtureModal;
document.getElementById('fixtureModalBg').onclick = e => {
  if (e.target === e.currentTarget) closeFixtureModal();
};

document.getElementById('fixtureForm').onsubmit = function(ev) {
  ev.preventDefault();
  const name = document.getElementById('fixtureName').value.trim();
  const type = document.getElementById('fixtureType').value.trim();
  const ft = document.getElementById('fixtureFt').value.trim();
  const newWall = document.getElementById('fixtureWall').value;
  if (!newWall) return;

  if (editingFixture) {
    if (editingFixture.wall !== newWall) {
      let oldArr = fixturesByWall[editingFixture.wall];
      let idx = oldArr.indexOf(editingFixture);
      if (idx > -1) oldArr.splice(idx, 1);
      fixturesByWall[newWall].push(editingFixture);
      editingFixture.customPos = null;
      editingFixture.wall = newWall;
    }
    editingFixture.name = name;
    editingFixture.type = type;
    editingFixture.ft = ft;
  } else {
    fixturesByWall[newWall].push({
      id: fixtureIdSeq++,
      name,
      type,
      ft,
      wall: newWall,
      customPos: null
    });
  }

  closeFixtureModal();
  renderWalls();
  renderFixtures();
};

document.getElementById('addFixtureBtn').onclick = () => openFixtureModal("add");

const toggleEditBtn = document.getElementById('toggleEditBtn');
toggleEditBtn.onclick = () => {
  isEditMode = !isEditMode;
  document.body.classList.toggle("edit-mode", isEditMode);
  toggleEditBtn.textContent = isEditMode ? "Cancel Edit" : "Edit Mode";
  renderFixtures();
};

window.addEventListener("resize", renderFixtures);

// Initial render
renderWalls();
renderFixtures();
</script>
</body>
</html>
